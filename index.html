<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Rabika's Burguer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(180deg,#06003a,#0a045a,#03001f);
  color:#fff;
  display:flex;
  justify-content:center;
}

/* SPLASH */
#splash{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#05002e,#020018);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.splash-box{text-align:center}
.splash-logo{width:360px;max-width:90%;margin-bottom:36px}
.splash-btn{
  background:linear-gradient(135deg,#FFD34D,#FFB000);
  border:none;
  padding:20px 60px;
  border-radius:50px;
  font-size:22px;
  font-weight:900;
  color:#2b0033;
  cursor:pointer;
}

/* APP */
#app{
  width:100%;
  max-width:420px;
  padding:16px 14px 360px;
  display:none;
}
.title{text-align:center;font-size:30px;font-weight:900;color:#FFD34D}
#status{text-align:center;font-size:13px;margin-top:4px}
#hours{text-align:center;font-size:12px;color:#FFD34D;margin-bottom:14px}

/* BUSCA */
.search{
  width:100%;
  padding:15px 18px;
  border-radius:30px;
  border:none;
  font-size:15px;
  margin-bottom:16px;
}

/* TABS */
.tabs{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
  margin-bottom:14px;
}
.tab{
  background:#fff;
  color:#2b0033;
  padding:12px 6px;
  border-radius:22px;
  font-weight:800;
  font-size:12px;
  text-align:center;
  cursor:pointer;
}
.tab span{display:block;font-size:22px}
.tab.active{background:#FFD34D}

/* BOX */
.box{
  background:#fff;
  color:#2b0033;
  border-radius:28px;
  padding:18px;
  margin-bottom:20px;
  display:none;
}
.box.active{display:block}

/* ITEM */
.item{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:10px;
  padding:12px 0;
  border-bottom:1px dashed #ddd;
  align-items:center;
}
.item-price{font-weight:900;color:#5a0070}
.btn-add{
  background:#5a0070;
  color:#fff;
  border:none;
  border-radius:14px;
  padding:6px 14px;
  font-weight:900;
}
.section{font-weight:900;margin:14px 0 6px;color:#5a0070}

/* OFERTA CLIENTE */
.item.offer{
  background:linear-gradient(90deg,#fff7d6,#fff);
  border-left:6px solid #FF9800;
  padding-left:10px;
}
.offer-badge{
  background:#FF9800;
  color:#fff;
  font-size:10px;
  font-weight:900;
  padding:2px 8px;
  border-radius:12px;
  margin-left:6px;
}
.old-price{
  text-decoration:line-through;
  font-size:12px;
  color:#999;
  display:block;
}
.offer-price{
  color:#d32f2f;
  font-weight:900;
}

/* CARRINHO */
#cart{
  position:fixed;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:100%;
  max-width:420px;
  background:#fff;
  color:#2b0033;
  padding:16px;
  border-radius:26px 26px 0 0;
  display:none;
  z-index:999;
}
.cart-item{display:flex;justify-content:space-between;margin-bottom:6px}

/* BOT√ïES */
.btn-green{
  background:#25D366;
  color:#fff;
  border:none;
  padding:14px;
  border-radius:22px;
  font-weight:900;
  width:100%;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
}
.modal-box{
  background:#fff;
  color:#2b0033;
  width:92%;
  max-width:420px;
  border-radius:26px;
  padding:22px;
  max-height:85vh;
  overflow-y:auto;
  position:relative;
}
.modal-close{
  position:absolute;
  top:10px;
  right:14px;
  font-size:22px;
  font-weight:900;
  cursor:pointer;
}

/* ADMIN OFERTAS */
.offer-input{background:#fff7cc;border:2px solid #FF9800}
.offer-date{border:2px dashed #FF9800}
.offer-save{background:#FF9800;color:#fff;font-weight:900}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="splash-box">
    <img src="logo.png" class="splash-logo">
    <button class="splash-btn" id="startBtn">FAZER PEDIDO</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="title">Rabika's Burguer</div>
  <div id="status"></div>
  <div id="hours">üïí Ter√ßa a Domingo ‚Äî 18:30 √†s 22:30</div>

  <input
    id="search"
    class="search"
    placeholder="Pesquisar no card√°pio ou digitar comandos (admin, oferta, relatorio)"
  >

  <!-- ABAS -->
  <div class="tabs">
    <div class="tab" onclick="openTab('lanches',this)">
      <span>üçî</span>Lanches
    </div>
    <div class="tab" onclick="openTab('porcoes',this)">
      <span>üçü</span>Por√ß√µes
    </div>
    <div class="tab" onclick="openTab('pasteis',this)">
      <span>ü•ü</span>Past√©is
    </div>
    <div class="tab" onclick="openTab('acai',this)">
      <span>üç®</span>A√ßa√≠
    </div>
    <div class="tab" onclick="openTab('bebidas',this)">
      <span>ü•§</span>Bebidas
    </div>
  </div>

  <!-- CONTE√öDO -->
  <div id="lanches" class="box"></div>
  <div id="porcoes" class="box"></div>
  <div id="pasteis" class="box"></div>
  <div id="acai" class="box"></div>
  <div id="bebidas" class="box"></div>
</div>
<script>
/* ================= CONFIGURA√á√ïES ================= */
const ADMIN_PASSWORD = "1234";
const FREIGHT = 8;

/* ================= ESTADO GLOBAL ================= */
let cart = [];
let currentTab = null;

/* ================= STORAGE ================= */
let customPrices = JSON.parse(localStorage.getItem("customPrices")) || {};
let productStatus = JSON.parse(localStorage.getItem("productStatus")) || {};
let extraProducts = JSON.parse(localStorage.getItem("extraProducts")) || {};
let offers = JSON.parse(localStorage.getItem("offers")) || {};
let sales = JSON.parse(localStorage.getItem("sales")) || [];

/* ================= SAFE ID (IDS SEGUROS) ================= */
function safeId(name){
  return name
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9]/g,"_");
}

/* ================= HOR√ÅRIO ================= */
function isOpen(){
  const d = new Date();
  const day = d.getDay();
  const h = d.getHours() + d.getMinutes()/60;

  if(day === 1) return false;          // segunda
  if(h < 18.5 || h > 22.5) return false;
  return true;
}

/* ================= PRODUTOS BASE ================= */
const products = {
  lanches:[
    {n:"X-Salada",p:17},{n:"X-Burguer",p:14},{n:"X-Frango",p:22},
    {n:"X-Frango Cremoso",p:20},{n:"X-Bacon",p:25},{n:"X-Calabresa",p:25},
    {n:"X-Cora√ß√£o",p:27},{n:"X-Tudo",p:32},{n:"X-Burguer Duplo",p:22},
    {n:"X-Egg",p:20},{n:"X-Tribom",p:32},{n:"X-Da Casa",p:45},{n:"X-Dog",p:20}
  ],
  adicionaisLanches:[
    {n:"Calabresa",p:7},{n:"Bacon",p:7},{n:"Cora√ß√£o",p:8},
    {n:"Ovo",p:3},{n:"Salsicha",p:4},{n:"Frango",p:7},
    {n:"Cheddar",p:4},{n:"Hamb√∫rguer artesanal",p:10},{n:"Maionese caseira",p:2}
  ],
  porcoes:[
    {n:"Fritas c/ Frango",p:39.99},{n:"Fritas",p:24.99},
    {n:"Fritas c/ Calabresa",p:34.99},{n:"Fritas c/ Bacon",p:34.99},
    {n:"An√©is de Cebola",p:24.99},
    {n:"Fritas c/ Bacon, Calabresa e Queijo",p:39.99},
    {n:"Fritas c/ Bacon Cheddar",p:39.99},
    {n:"Fritas c/ Polenta e Frango",p:39.99},
    {n:"Fritas c/ Polenta",p:24.99},
    {n:"Fritas c/ Calabresa e Catupiry",p:35.99},
    {n:"Fritas, Polenta, Chuleta e Anel de Cebola",p:49.99}
  ],
  pasteis:[
    {n:"Pastel de Carne",p:14},{n:"Pastel de Frango",p:12},
    {n:"Frango Bacon Cheddar",p:16},{n:"Bacon Cheddar",p:15},
    {n:"Calabresa c/ Cebola",p:14},{n:"Carne e Queijo",p:15},
    {n:"Queijo",p:14},{n:"Chocolate ao Leite",p:15},
    {n:"Banana Queijo Canela",p:15},{n:"Romeu e Julieta",p:15},
    {n:"Chocolate Branco",p:15},{n:"Creme e Ouro Branco",p:15},
    {n:"Creme e Sonho de Valsa",p:15}
  ],
  acaiTamanhos:[
    {n:"A√ßa√≠ 300ml",p:12},{n:"A√ßa√≠ 400ml",p:15},{n:"A√ßa√≠ 500ml",p:18}
  ],
  acaiAdicionais:[
    {n:"Pa√ßoca",p:2},{n:"Leite em p√≥",p:4},{n:"Granola",p:4},
    {n:"Morango",p:4},{n:"M&M",p:3},{n:"Ouro Branco",p:3},
    {n:"Banana",p:2},{n:"Sonho de Valsa",p:3},
    {n:"Leite Condensado",p:3},{n:"Nutella",p:4}
  ],
  bebidas:[
    {n:"Cassulinha 200ml",p:3},{n:"Coca-Cola 600ml",p:8},
    {n:"Coca-Cola 2L",p:16},{n:"Refri Lata",p:6},
    {n:"Refrigerante 2L",p:12},{n:"Cerveja Lata 350ml",p:6},
    {n:"Achocolatado 200ml",p:3}
  ]
};

/* ================= UTILIT√ÅRIOS ================= */
function getAllProducts(){
  let all = JSON.parse(JSON.stringify(products));
  Object.keys(extraProducts).forEach(cat=>{
    all[cat] = (all[cat] || []).concat(extraProducts[cat]);
  });
  return all;
}

function getPrice(p){
  const base = customPrices[p.n] ?? p.p;
  const offer = offers[p.n];
  if(offer){
    const today = new Date().toISOString().split("T")[0];
    if(today >= offer.start && today <= offer.end){
      return offer.price;
    }
  }
  return base;
}
</script>
<script>
/* ================= BOOT ================= */
function start(){
  document.getElementById("splash").style.display = "none";
  document.getElementById("app").style.display = "block";

  const status = document.getElementById("status");
  status.innerText = isOpen()
    ? "üü¢ Aberto agora"
    : "üî¥ Fechado ‚Äî pedidos indispon√≠veis";

  renderAll();
}

/* BOT√ÉO FAZER PEDIDO */
document.getElementById("startBtn").addEventListener("click", start);

/* ================= RENDER GERAL ================= */
function renderAll(){
  const all = getAllProducts();
  renderCategory("lanches", all.lanches, all.adicionaisLanches);
  renderCategory("porcoes", all.porcoes);
  renderCategory("pasteis", all.pasteis);
  renderAcai(all);
  renderCategory("bebidas", all.bebidas);
}

/* ================= RENDER CATEGORIA ================= */
function renderCategory(id, list, extras){
  const box = document.getElementById(id);
  box.innerHTML = "";

  list.forEach(p=>{
    if(productStatus[p.n] === false) return;
    box.innerHTML += itemHTML(p);
  });

  if(extras){
    box.innerHTML += `<div class="section">‚ûï Adicionais</div>`;
    extras.forEach(p=>{
      if(productStatus[p.n] !== false){
        box.innerHTML += itemHTML(p);
      }
    });
  }
}

/* ================= RENDER A√áA√ç ================= */
function renderAcai(all){
  const box = document.getElementById("acai");
  box.innerHTML = `<div class="section">ü•§ Tamanhos</div>`;

  all.acaiTamanhos.forEach(p=>{
    if(productStatus[p.n] !== false){
      box.innerHTML += itemHTML(p);
    }
  });

  box.innerHTML += `<div class="section">üç´ Adicionais</div>`;
  all.acaiAdicionais.forEach(p=>{
    if(productStatus[p.n] !== false){
      box.innerHTML += itemHTML(p);
    }
  });
}

/* ================= ITEM (COM OFERTA) ================= */
function isOfferActive(name){
  const offer = offers[name];
  if(!offer) return false;
  const today = new Date().toISOString().split("T")[0];
  return today >= offer.start && today <= offer.end;
}

function itemHTML(p){
  const basePrice = customPrices[p.n] ?? p.p;
  const finalPrice = getPrice(p);
  const hasOffer = isOfferActive(p.n);

  if(hasOffer){
    return `
      <div class="item offer" data-name="${p.n.toLowerCase()}">
        <div>
          <strong>${p.n}</strong>
          <span class="offer-badge">OFERTA</span>
          <span class="old-price">De: R$ ${basePrice.toFixed(2).replace(".",",")}</span>
          <span class="offer-price">Por: R$ ${finalPrice.toFixed(2).replace(".",",")}</span>
        </div>
        <span></span>
        <button class="btn-add" onclick="addItem('${p.n}',${finalPrice})">+</button>
      </div>
    `;
  }

  return `
    <div class="item" data-name="${p.n.toLowerCase()}">
      <span>${p.n}</span>
      <span class="item-price">R$ ${finalPrice.toFixed(2).replace(".",",")}</span>
      <button class="btn-add" onclick="addItem('${p.n}',${finalPrice})">+</button>
    </div>
  `;
}

/* ================= ABAS ================= */
function openTab(id, el){
  const box = document.getElementById(id);
  const isActive = box.classList.contains("active");

  document.querySelectorAll(".box").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));

  if(!isActive){
    box.classList.add("active");
    el.classList.add("active");
    currentTab = id;
  }else{
    currentTab = null;
  }
}

/* ================= BUSCA ================= */
const searchInput = document.getElementById("search");

searchInput.addEventListener("keydown", function(e){
  if(e.key !== "Enter") return;

  const v = this.value.toLowerCase().trim();
  const isCmd = ["admin","pre√ßo","precos","oferta","ofertas","relatorio","relat√≥rio"].includes(v);

  if(!isCmd) return;

  e.preventDefault();

  const s = prompt("Senha do administrador:");
  if(s !== ADMIN_PASSWORD){
    this.value = "";
    return;
  }

  if(v === "admin" || v === "pre√ßo" || v === "precos") openAdmin();
  if(v === "oferta" || v === "ofertas") openOffer();
  if(v === "relatorio" || v === "relat√≥rio") openReport();

  this.value = "";
});

searchInput.addEventListener("input", function(){
  const v = this.value.toLowerCase().trim();
  let foundTab = null;

  document.querySelectorAll(".item").forEach(i=>{
    const match = i.dataset.name.includes(v);
    i.style.display = match ? "grid" : "none";
    if(match && !foundTab){
      foundTab = i.closest(".box").id;
    }
  });

  if(foundTab){
    const tab = [...document.querySelectorAll(".tab")]
      .find(t=>t.getAttribute("onclick").includes(foundTab));
    if(tab) openTab(foundTab, tab);
  }

  if(!v){
    document.querySelectorAll(".item").forEach(i=>i.style.display="grid");
  }
});
</script>
<script>
/* ================= CARRINHO ================= */
function addItem(name, price){
  if(!isOpen()){
    alert("Estamos fechados.\nTer√ßa a Domingo das 18:30 √†s 22:30");
    return;
  }
  cart.push({ name, price });
  updateCart();
}

function updateCart(){
  let cartBox = document.getElementById("cart");

  if(!cartBox){
    document.body.insertAdjacentHTML("beforeend", `
      <div id="cart">
        <div id="cartItems"></div>
        <div id="total"></div>
        <button class="btn-green" onclick="finishOrder()">
          Finalizar Pedido
        </button>
      </div>
    `);
    cartBox = document.getElementById("cart");
  }

  const itemsBox = document.getElementById("cartItems");
  itemsBox.innerHTML = "";

  let total = 0;

  cart.forEach((item, index)=>{
    total += item.price;
    itemsBox.innerHTML += `
      <div class="cart-item">
        <span>${item.name}</span>
        <span>R$ ${item.price.toFixed(2).replace(".",",")}</span>
        <button onclick="removeItem(${index})">‚úï</button>
      </div>
    `;
  });

  document.getElementById("total").innerText =
    "Total: R$ " + total.toFixed(2).replace(".",",");

  cartBox.style.display = cart.length ? "block" : "none";
}

function removeItem(index){
  cart.splice(index, 1);
  updateCart();
}

/* ================= CHECKOUT ‚Äî ESTADO ================= */
let checkout = {
  delivery: false,
  name: "",
  address: "",
  payment: ""
};

/* ================= VERIFICA BEBIDA ================= */
function cartHasDrink(){
  const drinks = products.bebidas.map(b => b.n);
  return cart.some(i => drinks.includes(i.name));
}

/* ================= FINALIZAR ================= */
function finishOrder(){
  if(document.getElementById("drinkModal") || document.getElementById("deliveryModal")){
    return;
  }

  if(!cartHasDrink()){
    showDrinkConfirm();
    return;
  }
  askDelivery();
}

/* ================= MODAL BEBIDA ================= */
function showDrinkConfirm(){
  if(document.getElementById("drinkModal")) return;

  document.body.insertAdjacentHTML("beforeend", `
    <div class="modal" id="drinkModal" style="display:flex">
      <div class="modal-box">
        <h2 style="text-align:center">Voc√™ vai querer bebida?</h2>
        <div class="choice">
          <button class="yes" onclick="goToDrinks()">SIM</button>
          <button class="no" onclick="closeDrinkModal()">N√ÉO</button>
        </div>
      </div>
    </div>
  `);
}

function goToDrinks(){
  const modal = document.getElementById("drinkModal");
  if(modal) modal.remove();

  const tabs = document.querySelectorAll(".tab");
  openTab("bebidas", tabs[tabs.length - 1]);
}

function closeDrinkModal(){
  const modal = document.getElementById("drinkModal");
  if(modal) modal.remove();

  askDelivery();
}

/* ================= ENTREGA / RETIRADA ================= */
function askDelivery(){
  if(document.getElementById("deliveryModal")) return;

  document.body.insertAdjacentHTML("beforeend", `
    <div class="modal" id="deliveryModal" style="display:flex">
      <div class="modal-box">
        <h2 style="text-align:center">Entrega ou Retirada?</h2>
        <div class="choice">
          <button class="yes" onclick="setDelivery(true)">ENTREGA</button>
          <button class="no" onclick="setDelivery(false)">RETIRADA</button>
        </div>
      </div>
    </div>
  `);
}

function setDelivery(isDelivery){
  checkout.delivery = isDelivery;

  const modal = document.getElementById("deliveryModal");
  if(modal) modal.remove();

  askName();
}

/* ================= NOME ================= */
function askName(){
  const name = prompt("Informe seu nome:");
  if(!name) return;
  checkout.name = name;

  if(checkout.delivery){
    askAddress();
  }else{
    askPayment();
  }
}

/* ================= ENDERE√áO ================= */
function askAddress(){
  const address = prompt("Informe o endere√ßo de entrega:");
  if(!address) return;
  checkout.address = address;

  askPayment();
}

/* ================= PAGAMENTO ================= */
function askPayment(){
  const payment = prompt(
    "Forma de pagamento? (dinheiro / pix / debito / credito)"
  );
  if(!payment) return;
  checkout.payment = payment;

  sendOrder();
}

/* ================= WHATSAPP ================= */
function sendOrder(){
  let msg = "üçî Pedido Rabika's Burguer\n\n";
  let total = 0;

  cart.forEach(i=>{
    msg += `- ${i.name} R$ ${i.price.toFixed(2).replace(".",",")}\n`;
    total += i.price;
  });

  if(checkout.delivery){
    msg += "\nEntrega: R$ 8,00\n";
    total += FREIGHT;
    msg += `Endere√ßo: ${checkout.address}\n`;
  }else{
    msg += "\nRetirada no local\n";
  }

  msg += `Nome: ${checkout.name}\n`;
  msg += `Pagamento: ${checkout.payment}\n`;
  msg += `\nTotal: R$ ${total.toFixed(2).replace(".",",")}`;

  sales.push({
    date: new Date().toISOString(),
    total,
    payment: checkout.payment
  });
  localStorage.setItem("sales", JSON.stringify(sales));

  window.open(
    "https://wa.me/554991789706?text=" + encodeURIComponent(msg),
    "_blank"
  );

  cart = [];
  updateCart();
}
</script>
<!-- ================= MODAL ADMIN ================= -->
<div id="adminModal" class="modal">
  <div class="modal-box">
    <div class="modal-close" onclick="closeAdmin()">‚úï</div>

    <h2 style="text-align:center;color:#5a0070">Painel Administrativo</h2>
    <p style="text-align:center;font-size:13px;margin-bottom:16px">
      Gerencie pre√ßos, visibilidade e produtos
    </p>

    <h3 style="color:#5a0070">Produtos Ativos</h3>
    <div id="adminActive"></div>

    <h3 style="color:#b00020;margin-top:20px">Produtos Ocultos</h3>
    <div id="adminHidden"></div>

    <h3 style="color:#5a0070;margin-top:24px">+ Novo Produto</h3>

    <input id="newName" class="search" placeholder="Nome do produto">
    <input id="newPrice" class="search" type="number" placeholder="Pre√ßo">

    <select id="newCategory" class="search">
      <option value="">Categoria</option>
      <option value="lanches">Lanches</option>
      <option value="adicionaisLanches">Adicionais</option>
      <option value="porcoes">Por√ß√µes</option>
      <option value="pasteis">Past√©is</option>
      <option value="acaiTamanhos">A√ßa√≠ (Tamanho)</option>
      <option value="acaiAdicionais">A√ßa√≠ (Adicional)</option>
      <option value="bebidas">Bebidas</option>
    </select>

    <button class="btn-green" onclick="addNewProduct()">
      Adicionar Produto
    </button>
  </div>
</div>

<script>
/* ================= ADMIN ================= */
function openAdmin(){
  document.getElementById("adminModal").style.display = "flex";
  renderAdmin();
}

function closeAdmin(){
  document.getElementById("adminModal").style.display = "none";
}

/* ================= RENDER ADMIN ================= */
function renderAdmin(){
  const activeBox = document.getElementById("adminActive");
  const hiddenBox = document.getElementById("adminHidden");
  activeBox.innerHTML = "";
  hiddenBox.innerHTML = "";

  const all = getAllProducts();

  Object.keys(all).forEach(cat=>{
    all[cat].forEach(p=>{
      const price = getPrice(p);
      const hidden = productStatus[p.n] === false;
      const sid = safeId(p.n);

      const row = `
        <div style="margin-bottom:16px">
          <strong>${p.n}</strong>

          <input
            type="number"
            class="search"
            id="price-${sid}"
            value="${price}"
          >

          <button class="btn-green" onclick="savePrice('${p.n}')">
            Salvar
          </button>

          <button
            class="btn-green"
            style="background:#999;margin-top:6px"
            onclick="toggleProduct('${p.n}')"
          >
            ${hidden ? "Reativar" : "Ocultar"}
          </button>
        </div>
      `;

      if(hidden){
        hiddenBox.innerHTML += row;
      }else{
        activeBox.innerHTML += row;
      }
    });
  });
}

/* ================= SALVAR PRE√áO ================= */
function savePrice(name){
  const sid = safeId(name);
  const input = document.getElementById("price-" + sid);
  if(!input) return;

  customPrices[name] = Number(input.value);
  localStorage.setItem("customPrices", JSON.stringify(customPrices));
  renderAll();
}

/* ================= OCULTAR / REATIVAR ================= */
function toggleProduct(name){
  productStatus[name] =
    productStatus[name] === false ? true : false;

  localStorage.setItem(
    "productStatus",
    JSON.stringify(productStatus)
  );

  renderAll();
  renderAdmin();
}

/* ================= ADICIONAR NOVO PRODUTO ================= */
function addNewProduct(){
  const name = document.getElementById("newName").value.trim();
  const price = Number(document.getElementById("newPrice").value);
  const category = document.getElementById("newCategory").value;

  if(!name || !price || !category){
    alert("Preencha todos os campos");
    return;
  }

  if(!extraProducts[category]){
    extraProducts[category] = [];
  }

  extraProducts[category].push({ n: name, p: price });

  localStorage.setItem(
    "extraProducts",
    JSON.stringify(extraProducts)
  );

  document.getElementById("newName").value = "";
  document.getElementById("newPrice").value = "";
  document.getElementById("newCategory").value = "";

  renderAll();
  renderAdmin();
}
</script>
<!-- ================= MODAL OFERTAS ================= -->
<div id="offerModal" class="modal">
  <div class="modal-box">
    <div class="modal-close" onclick="closeOffer()">‚úï</div>

    <h2 style="text-align:center;color:#5a0070">
      M√≥dulo de Ofertas
    </h2>

    <p style="text-align:center;font-size:13px;margin-bottom:16px">
      Configure pre√ßos promocionais com per√≠odo de validade
    </p>

    <div id="offerList"></div>
  </div>
</div>

<script>
/* ================= OFERTAS ================= */
function openOffer(){
  document.getElementById("offerModal").style.display = "flex";
  renderOffers();
}

function closeOffer(){
  document.getElementById("offerModal").style.display = "none";
}

/* ================= STATUS DA OFERTA ================= */
function getOfferStatus(offer){
  if(!offer) return "SEM OFERTA";

  const today = new Date().toISOString().split("T")[0];
  if(today < offer.start) return "AGENDADA";
  if(today > offer.end) return "EXPIRADA";
  return "ATIVA";
}

/* ================= RENDER OFERTAS ================= */
function renderOffers(){
  const box = document.getElementById("offerList");
  box.innerHTML = "";

  const all = getAllProducts();

  Object.keys(all).forEach(cat=>{
    all[cat].forEach(p=>{
      const offer = offers[p.n];
      const status = getOfferStatus(offer);
      const sid = safeId(p.n);

      let statusColor = "#999";
      if(status === "ATIVA") statusColor = "#25D366";
      if(status === "EXPIRADA") statusColor = "#b00020";
      if(status === "AGENDADA") statusColor = "#FF9800";

      box.innerHTML += `
        <div style="
          margin-bottom:26px;
          padding:16px;
          border-radius:18px;
          border:2px solid ${statusColor};
          background:#fafafa
        ">

          <strong style="font-size:15px">${p.n}</strong>

          <div style="margin:6px 0;font-size:12px;color:${statusColor};font-weight:900">
            Status: ${status}
          </div>

          <label style="font-size:12px;font-weight:700">
            üí∏ Pre√ßo promocional
          </label>
          <input
            class="search offer-input"
            type="number"
            placeholder="Valor de oferta"
            id="offerPrice-${sid}"
            value="${offer?.price ?? ""}"
          >

          <label style="font-size:12px;font-weight:700">
            üìÖ Data de in√≠cio
          </label>
          <input
            class="search offer-date"
            type="date"
            id="offerStart-${sid}"
            value="${offer?.start ?? ""}"
          >

          <label style="font-size:12px;font-weight:700">
            üìÖ Data de fim
          </label>
          <input
            class="search offer-date"
            type="date"
            id="offerEnd-${sid}"
            value="${offer?.end ?? ""}"
          >

          <button
            class="btn-green offer-save"
            onclick="saveOffer('${p.n}')"
          >
            üíæ Salvar Oferta
          </button>

          ${
            offer
              ? `<button
                   class="btn-green"
                   style="background:#999;margin-top:8px"
                   onclick="removeOffer('${p.n}')"
                 >
                   ‚ùå Remover Oferta
                 </button>`
              : ""
          }
        </div>
      `;
    });
  });
}

/* ================= SALVAR OFERTA ================= */
function saveOffer(name){
  const sid = safeId(name);

  const priceInput = document.getElementById("offerPrice-" + sid);
  const startInput = document.getElementById("offerStart-" + sid);
  const endInput   = document.getElementById("offerEnd-" + sid);

  if(!priceInput || !startInput || !endInput){
    alert("Erro ao localizar campos da oferta");
    return;
  }

  const price = Number(priceInput.value);
  const start = startInput.value;
  const end   = endInput.value;

  if(!price || !start || !end){
    alert("Preencha valor e datas da oferta");
    return;
  }

  offers[name] = { price, start, end };
  localStorage.setItem("offers", JSON.stringify(offers));

  renderAll();
  renderOffers();
}

/* ================= REMOVER OFERTA ================= */
function removeOffer(name){
  delete offers[name];
  localStorage.setItem("offers", JSON.stringify(offers));

  renderAll();
  renderOffers();
}
</script>
<!-- ================= MODAL RELAT√ìRIO ================= -->
<div id="reportModal" class="modal">
  <div class="modal-box">
    <div class="modal-close" onclick="closeReport()">‚úï</div>

    <h2 style="text-align:center;color:#5a0070">
      Relat√≥rio de Vendas
    </h2>

    <p style="text-align:center;font-size:13px;margin-bottom:16px">
      Totais acumulados por forma de pagamento
    </p>

    <div style="margin-bottom:10px">
      <strong>Total Geral:</strong>
      <span id="repTotal"></span>
    </div>

    <div style="margin-bottom:6px">
      <strong>Dinheiro:</strong>
      <span id="repCash"></span>
    </div>

    <div style="margin-bottom:6px">
      <strong>Pix:</strong>
      <span id="repPix"></span>
    </div>

    <div style="margin-bottom:6px">
      <strong>D√©bito:</strong>
      <span id="repDebit"></span>
    </div>

    <div style="margin-bottom:6px">
      <strong>Cr√©dito:</strong>
      <span id="repCredit"></span>
    </div>
  </div>
</div>

<script>
/* ================= RELAT√ìRIO ================= */
function openReport(){
  document.getElementById("reportModal").style.display = "flex";
  renderReport();
}

function closeReport(){
  document.getElementById("reportModal").style.display = "none";
}

/* ================= RENDER RELAT√ìRIO ================= */
function renderReport(){
  let total = 0;
  let dinheiro = 0;
  let pix = 0;
  let debito = 0;
  let credito = 0;

  sales.forEach(s=>{
    total += s.total;

    if(s.payment === "dinheiro") dinheiro += s.total;
    if(s.payment === "pix") pix += s.total;
    if(s.payment === "debito") debito += s.total;
    if(s.payment === "credito") credito += s.total;
  });

  document.getElementById("repTotal").innerText =
    "R$ " + total.toFixed(2).replace(".",",");

  document.getElementById("repCash").innerText =
    "R$ " + dinheiro.toFixed(2).replace(".",",");

  document.getElementById("repPix").innerText =
    "R$ " + pix.toFixed(2).replace(".",",");

  document.getElementById("repDebit").innerText =
    "R$ " + debito.toFixed(2).replace(".",",");

  document.getElementById("repCredit").innerText =
    "R$ " + credito.toFixed(2).replace(".",",");
}
</script>

  <script>
/* ================= FIX ‚Äî REAPLICAR OFERTAS AP√ìS RELOAD ================= */
window.addEventListener("load", () => {
  // garante que ofertas do localStorage sejam reaplicadas
  setTimeout(() => {
    if(typeof renderAll === "function"){
      renderAll();
    }
  }, 50);
});
</script>

  
</body>
</html>

