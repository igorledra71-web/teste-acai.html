<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Rabika's Burguer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCYi1rHHuUPV1QB64N9ciBXNvER3caUc0k",
  authDomain: "rabikas-burguer.firebaseapp.com",
  databaseURL: "https://rabikas-burguer-default-rtdb.firebaseio.com",
  projectId: "rabikas-burguer",
  storageBucket: "rabikas-burguer.appspot.com",
  messagingSenderId: "922454808804",
  appId: "1:922454808804:web:d0aa9ae5fc78b8d10674f1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow-x:hidden}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(180deg,#06003a,#0a045a,#03001f);
  color:#fff;
  display:flex;
  justify-content:center;
}
#splash{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#05002e,#020018);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.splash-box{text-align:center}
.splash-logo{
  max-width:420px;
  width:100%;
  margin-bottom:40px;
}
.splash-btn{
  background:linear-gradient(135deg,#FFD34D,#FFB000);
  border:none;
  padding:20px 60px;
  border-radius:50px;
  font-size:24px;
  font-weight:900;
  color:#2b0033;
  cursor:pointer;
}
#app{
  width:100%;
  max-width:420px;
  padding:14px 14px 320px;
  display:none;
}
.title{
  text-align:center;
  font-size:32px;
  font-weight:900;
  color:#FFD34D;
}
.search{
  width:100%;
  padding:16px;
  border-radius:26px;
  border:none;
  margin:14px 0;
  font-size:15px;
  font-weight:600;
}
.tabs{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(min-width:420px){
  .tabs{grid-template-columns:repeat(5,1fr)}
}
.tab{
  background:#fff;
  color:#2b0033;
  border-radius:22px;
  font-weight:800;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:16px 10px;
}
.tab.active{background:#FFD34D}
.box{
  background:#fff;
  color:#2b0033;
  border-radius:28px;
  padding:18px;
  display:none;
}
.box.active{display:block}
.item{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:10px;
  padding:14px 0;
  border-bottom:1px dashed #ddd;
  align-items:center;
}
.item-name{font-size:17px;font-weight:800}
.item-price{font-size:15px;font-weight:800;color:#5a0070}
.item.offer{
  background:#fff1e0;
  border:2px solid #ff6b00;
  border-radius:18px;
  padding:14px;
}
.old-price{
  text-decoration:line-through;
  font-size:13px;
  opacity:.7;
}
.offer-price{
  font-size:22px;
  font-weight:900;
  color:#b00020;
}
.btn-add{
  background:#5a0070;
  color:#fff;
  border:none;
  width:42px;
  height:42px;
  border-radius:50%;
  font-size:18px;
  font-weight:900;
}
.btn-green{
  background:#25D366;
  color:#fff;
  border:none;
  padding:16px;
  border-radius:24px;
  font-weight:900;
  width:100%;
}
.btn-gray{
  background:#ccc;
  color:#333;
  border:none;
  padding:14px;
  border-radius:24px;
  font-weight:900;
  width:100%;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
}
.modal-box{
  background:#fff;
  color:#2b0033;
  width:92%;
  max-width:420px;
  border-radius:26px;
  padding:20px;
  max-height:85vh;
  overflow-y:auto;
}
</style>
</head>
<body>

<!-- ================= SPLASH ================= -->
<div id="splash">
  <div class="splash-box">
    <img src="logo.png" class="splash-logo">
    <button class="splash-btn" onclick="startApp()">FAZER PEDIDO</button>
  </div>
</div>

<!-- ================= APP ================= -->
<div id="app">

  <div class="title">Rabika's Burguer</div>

  <div style="text-align:center;font-size:13px;margin-top:4px">
    üïí Ter√ßa a Domingo ‚Äî 18:30 √†s 22:30
  </div>

  <!-- BUSCA -->
  <input id="search" class="search" placeholder="">

  <!-- ================= ABAS ================= -->
  <div class="tabs">

    <div class="tab" onclick="openTab('lanches',this)">
      üçî
      <span>Lanches</span>
    </div>

    <div class="tab" onclick="openTab('porcoes',this)">
      üçü
      <span>Por√ß√µes</span>
    </div>

    <div class="tab" onclick="openTab('pasteis',this)">
      ü•ü
      <span>Past√©is</span>
    </div>

    <div class="tab" onclick="openTab('acai',this)">
      üç®
      <span>A√ßa√≠</span>
    </div>

    <div class="tab" onclick="openTab('bebidas',this)">
      ü•§
      <span>Bebidas</span>
    </div>

  </div>

  <!-- ================= CONTE√öDO ================= -->
  <div id="lanches" class="box"></div>
  <div id="porcoes" class="box"></div>
  <div id="pasteis" class="box"></div>
  <div id="acai" class="box"></div>
  <div id="bebidas" class="box"></div>

</div>
<script>
/* ================= CONFIG ================= */
const ADMIN_PASSWORD = "1234";
const FREIGHT = 8;

/* ================= ESTADOS ================= */
let cart = [];
let cartOpen = false;
let isDelivery = false;
let currentTab = "";

let customPrices = {};
let productStatus = {};
let offers = {};
let sales = {};

/* üîí BLOQUEIO GLOBAL DE PEDIDOS */
let orderBlocked = false;

/* ================= FIREBASE LISTENERS ================= */
db.ref("prices").on("value", snap=>{
  customPrices = snap.val() || {};
  renderAll();
});

db.ref("productStatus").on("value", snap=>{
  productStatus = snap.val() || {};
  renderAll();
});

db.ref("offers").on("value", snap=>{
  offers = snap.val() || {};
  renderAll();
});

db.ref("sales").on("value", snap=>{
  sales = snap.val() || {};
});

/* üîí LISTENER DO BLOQUEIO (√öNICO E DEFINITIVO) */
db.ref("settings/orderBlocked").on("value", snap=>{
  orderBlocked = snap.val() === true;
});

/* ================= UTIL ================= */
function safeId(name){
  return name
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9]/g,"");
}

/* ================= HOR√ÅRIO ================= */
function isOpen(){
  const d = new Date();
  const day = d.getDay();
  const h = d.getHours() + d.getMinutes()/60;

  if(day === 1) return false;
  if(h < 18.5 || h > 22.5) return false;
  return true;
}

/* ================= REGRA FINAL ================= */
function isOrderAllowed(){
  // Se o dono liberou manualmente, libera sempre
  if(orderBlocked === false) return true;

  // Caso contr√°rio, respeita hor√°rio
  return isOpen();
}

</script>
<script>
/* ================= PRODUTOS ================= */
const products = {
  lanches:[
    {n:"X-Salada",p:17},{n:"X-Burguer",p:14},{n:"X-Frango",p:22},
    {n:"X-Frango Cremoso",p:20},{n:"X-Bacon",p:25},{n:"X-Calabresa",p:25},
    {n:"X-Cora√ß√£o",p:27},{n:"X-Tudo",p:32},{n:"X-Burguer Duplo",p:22},
    {n:"X-Egg",p:20},{n:"X-Tribom",p:32},{n:"X-Da Casa",p:45},
    {n:"X-Dog",p:20}
  ],
  adicionais:[
    {n:"Calabresa",p:7},{n:"Bacon",p:7},{n:"Cora√ß√£o",p:8},
    {n:"Ovo",p:3},{n:"Salsicha",p:4},{n:"Frango",p:7},
    {n:"Cheddar",p:4},{n:"Hamb√∫rguer artesanal",p:10},
    {n:"Maionese caseira",p:2}
  ],
  porcoes:[
    {n:"Fritas",p:24.99},{n:"Fritas c/ Frango",p:39.99},
    {n:"Fritas c/ Calabresa",p:34.99},{n:"Fritas c/ Bacon",p:34.99},
    {n:"An√©is de Cebola",p:24.99},
    {n:"Fritas c/ Bacon, Calabresa e Queijo",p:39.99},
    {n:"Fritas c/ Bacon Cheddar",p:39.99},
    {n:"Fritas c/ Polenta e Frango",p:39.99},
    {n:"Fritas c/ Polenta",p:24.99},
    {n:"Fritas c/ Calabresa e Catupiry",p:35.99},
    {n:"Fritas, Polenta, Chuleta e Anel de Cebola",p:49.99}
  ],
  pasteis:[
    {n:"Pastel de Carne",p:14},{n:"Pastel de Frango",p:12},
    {n:"Frango Bacon Cheddar",p:16},{n:"Bacon Cheddar",p:15},
    {n:"Calabresa c/ Cebola",p:14},{n:"Carne e Queijo",p:15},
    {n:"Queijo",p:14},{n:"Chocolate ao Leite",p:15},
    {n:"Banana Queijo Canela",p:15},{n:"Romeu e Julieta",p:15},
    {n:"Chocolate Branco",p:15},{n:"Creme e Ouro Branco",p:15},
    {n:"Creme e Sonho de Valsa",p:15}
  ],
  acaiTamanhos:[
    {n:"A√ßa√≠ 300ml",p:12},{n:"A√ßa√≠ 400ml",p:15},{n:"A√ßa√≠ 500ml",p:18}
  ],
  acaiAdicionais:[
    {n:"Pa√ßoca",p:2},{n:"Leite em p√≥",p:4},{n:"Granola",p:4},
    {n:"Morango",p:4},{n:"M&M",p:3},{n:"Ouro Branco",p:3},
    {n:"Banana",p:2},{n:"Sonho de Valsa",p:3},
    {n:"Leite Condensado",p:3},{n:"Nutella",p:4}
  ],
  bebidas:[
    {n:"Cassulinha 200ml",p:3},{n:"Coca-Cola 600ml",p:8},
    {n:"Coca-Cola 2L",p:16},{n:"Refri Lata",p:6},
    {n:"Refrigerante 2L",p:12},{n:"Cerveja Lata 350ml",p:6},
    {n:"Achocolatado 200ml",p:3}
  ]
};

/* ================= PRE√áOS ================= */
function getPrice(item){
  const id = safeId(item.n);

  if(offers[id]){
    return {
      price: offers[id].price,
      original: item.p,
      offer: true
    };
  }

  if(customPrices[id] !== undefined){
    return {
      price: customPrices[id],
      original: null,
      offer: false
    };
  }

  return {
    price: item.p,
    original: null,
    offer: false
  };
}

/* ================= ITEM ================= */
function renderItem(item){
  const id = safeId(item.n);
  if(productStatus[id] === false) return "";

  const p = getPrice(item);

  return `
    <div class="item ${p.offer ? 'offer' : ''}">
      <div class="item-name">${p.offer ? 'üî• ' : ''}${item.n}</div>
      <div class="item-price">
        ${p.offer && p.original
          ? `<div class="old-price">R$ ${p.original.toFixed(2).replace('.',',')}</div>`
          : ``}
        <div class="${p.offer ? 'offer-price' : ''}">
          R$ ${p.price.toFixed(2).replace('.',',')}
        </div>
      </div>
      <button class="btn-add" onclick="addToCart('${item.n}',${p.price})">+</button>
    </div>
  `;
}

/* ================= CATEGORIAS ================= */
function renderCategory(id,list,extras){
  const box = document.getElementById(id);
  box.innerHTML = "";

  list.forEach(i=>{
    box.innerHTML += renderItem(i);
  });

  if(extras){
    box.innerHTML += `<div class="section">‚ûï Adicionais</div>`;
    extras.forEach(i=>{
      box.innerHTML += renderItem(i);
    });
  }
}

/* ================= A√áA√ç ================= */
function renderAcai(){
  const box = document.getElementById("acai");
  box.innerHTML = `<div class="section">ü•§ Tamanhos</div>`;
  products.acaiTamanhos.forEach(i=>{
    box.innerHTML += renderItem(i);
  });
  box.innerHTML += `<div class="section">üç´ Adicionais</div>`;
  products.acaiAdicionais.forEach(i=>{
    box.innerHTML += renderItem(i);
  });
}

/* ================= RENDER GERAL ================= */
function renderAll(){
  renderCategory("lanches",products.lanches,products.adicionais);
  renderCategory("porcoes",products.porcoes);
  renderCategory("pasteis",products.pasteis);
  renderAcai();
  renderCategory("bebidas",products.bebidas);
}
</script>
<script>
/* ================= START ================= */
function startApp(){
  document.getElementById("splash").style.display = "none";
  document.getElementById("app").style.display = "block";
  renderAll();
}

/* ================= ABAS ================= */
function openTab(id,el){
  currentTab = id;

  document.querySelectorAll(".box").forEach(b=>{
    b.classList.remove("active");
  });

  document.getElementById(id).classList.add("active");

  document.querySelectorAll(".tab").forEach(t=>{
    t.classList.remove("active");
  });

  if(el) el.classList.add("active");
}

/* ================= CARRINHO ================= */
function addToCart(name,price){

  if(!isOrderAllowed()){
    alert("Estamos fechados no momento.");
    return;
  }

  cart.push({name,price});
  renderCart();
}

function toggleCart(){
  cartOpen = !cartOpen;
  renderCart();
}

function renderCart(){
  let cartBox = document.getElementById("cart");

  if(!cartBox){
    document.body.insertAdjacentHTML("beforeend",`
      <div id="cart"
        style="
          position:fixed;
          bottom:0;
          left:50%;
          transform:translateX(-50%);
          width:100%;
          max-width:420px;
          background:#fff;
          color:#2b0033;
          border-radius:28px 28px 0 0;
          z-index:9999
        ">

        <div id="cartHeader"
          style="
            padding:12px;
            font-weight:900;
            cursor:pointer;
            text-align:center;
            background:#FFD34D;
            border-radius:28px 28px 0 0
          "
          onclick="toggleCart()">
        </div>

        <div id="cartContent" style="padding:18px;display:none">
          <div id="cartItems"></div>

          <div style="margin:10px 0">
            <label>
              <input type="radio" name="delivery" checked onclick="setDelivery(false)">
              Retirada
            </label>
            &nbsp;&nbsp;
            <label>
              <input type="radio" name="delivery" onclick="setDelivery(true)">
              Entrega
            </label>
          </div>

          <input id="customerName" class="search" placeholder="Seu nome">
          <input id="address" class="search" placeholder="Endere√ßo para entrega" style="display:none">

          <select id="payment" class="search">
            <option value="">Forma de pagamento</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Pix">Pix</option>
            <option value="D√©bito">Cart√£o D√©bito</option>
            <option value="Cr√©dito">Cart√£o Cr√©dito</option>
          </select>

          <div id="cartTotal" style="font-weight:900;margin:10px 0"></div>

          <button class="btn-green" onclick="finishOrder()">
            Finalizar Pedido
          </button>
        </div>
      </div>
    `);
    cartBox = document.getElementById("cart");
  }

  const header = document.getElementById("cartHeader");
  const content = document.getElementById("cartContent");
  const itemsBox = document.getElementById("cartItems");

  itemsBox.innerHTML = "";
  let total = 0;

  cart.forEach((i,idx)=>{
    total += i.price;
    itemsBox.innerHTML += `
      <div style="display:flex;justify-content:space-between;margin-bottom:6px">
        <span>${i.name}</span>
        <span>
          R$ ${i.price.toFixed(2).replace('.',',')}
          <button onclick="removeFromCart(${idx})">‚úï</button>
        </span>
      </div>
    `;
  });

  if(isDelivery) total += FREIGHT;

  header.innerHTML = `
    üõí ${cart.length} item(s) ‚Äî
    R$ ${total.toFixed(2).replace('.',',')}
    ${cartOpen ? '‚ñº' : '‚ñ≤'}
  `;

  document.getElementById("cartTotal").innerText =
    "Total: R$ " + total.toFixed(2).replace('.',',');

  content.style.display = cartOpen ? "block" : "none";
  cartBox.style.display = cart.length ? "block" : "none";
}

function removeFromCart(i){
  cart.splice(i,1);
  renderCart();
}

function setDelivery(v){
  isDelivery = v;
  document.getElementById("address").style.display = v ? "block" : "none";
  renderCart();
}
</script>
<script>
/* ================= REGRA BEBIDA ================= */
function finishOrder(){

  if(!isOrderAllowed()){
    alert("Pedidos est√£o bloqueados no momento.");
    return;
  }

  const hasMain = cart.some(i =>
    products.lanches.some(l=>l.n===i.name) ||
    products.porcoes.some(p=>p.n===i.name) ||
    products.pasteis.some(pa=>pa.n===i.name)
  );

  const hasDrink = cart.some(i =>
    products.bebidas.some(b=>b.n===i.name)
  );

  if(hasMain && !hasDrink){
    document.getElementById("drinkModal").style.display = "flex";
    return;
  }

  checkPayment();
}

/* ================= TROCO ================= */
let changeInfo = "";

function checkPayment(){
  const pay = document.getElementById("payment").value;
  if(pay === "Dinheiro"){
    document.getElementById("changeModal").style.display = "flex";
  }else{
    sendOrder();
  }
}

function confirmChange(need){
  document.getElementById("changeModal").style.display = "none";

  if(!need){
    changeInfo = "N√£o precisa";
    sendOrder();
  }else{
    document.getElementById("changeValueModal").style.display = "flex";
  }
}

function saveChangeValue(){
  const v = document.getElementById("changeValue").value;
  if(!v){
    alert("Informe o valor do troco");
    return;
  }

  changeInfo = "Troco para R$ " + Number(v).toFixed(2).replace(".",",");
  document.getElementById("changeValueModal").style.display = "none";
  sendOrder();
}

/* ================= ENVIO WHATSAPP ================= */
function sendOrder(){

  if(!isOrderAllowed()){
    alert("Pedidos est√£o bloqueados no momento.");
    return;
  }

  const name = document.getElementById("customerName").value || "Cliente";
  const pay = document.getElementById("payment").value || "N√£o informado";
  const addr = isDelivery ? document.getElementById("address").value : "";

  let msg = `### PEDIDO AUTOM√ÅTICO ###\nüçî Rabika's Burguer\n\nüë§ ${name}\n\n`;
  let total = 0;

  cart.forEach(i=>{
    msg += `‚Ä¢ ${i.name} ‚Äî R$ ${i.price.toFixed(2).replace(".",",")}\n`;
    total += i.price;
  });

  if(isDelivery){
    msg += `\nüöö Entrega: R$ ${FREIGHT.toFixed(2).replace(".",",")}\nüìç ${addr}\n`;
    total += FREIGHT;
  }else{
    msg += `\nüè† Retirada no local\n`;
  }

  msg += `\nüí≥ Pagamento: ${pay}`;
  if(pay === "Dinheiro") msg += `\nüí∞ Troco: ${changeInfo}`;
  msg += `\n\nTOTAL: R$ ${total.toFixed(2).replace(".",",")}`;

// ================= SALVAR PEDIDO PARA IMPRESS√ÉO =================
db.ref("orders").push({
  status: "novo",
  printed: false,
  createdAt: Date.now(),

  cliente: {
    nome: name,
    tipo: isDelivery ? "Entrega" : "Retirada",
    endereco: addr || ""
  },

  pagamento: {
    forma: pay,
    troco: pay === "Dinheiro" ? changeInfo : ""
  },

  itens: cart.map(i => ({
    nome: i.name,
    preco: i.price
  })),

  total: total
});

  window.open(
    "https://wa.me/554991789706?text=" + encodeURIComponent(msg),
    "_blank"
  );

  let itemsText = "";
cart.forEach(i=>{
  itemsText += `${i.name} ‚Äî R$ ${i.price.toFixed(2).replace(".",",")}\n`;
});

 db.ref("sales").push({
  total: total,
  payment: pay,
  date: new Date().toISOString(),
  hour: new Date().toLocaleTimeString("pt-BR", {
    hour: "2-digit",
    minute: "2-digit"
  }),
  items: itemsText
});

  cart = [];
  cartOpen = false;
  changeInfo = "";
  renderCart();
}
</script>

<!-- ================= MODAIS ================= -->

<div class="modal" id="drinkModal" style="display:none">
  <div class="modal-box">
    <h3 style="text-align:center;margin-bottom:16px">
      Voc√™ vai querer bebida?
    </h3>

    <button class="btn-green"
      onclick="
        document.getElementById('drinkModal').style.display='none';
        cartOpen=false;
        renderCart();
        openTab('bebidas');
      ">
      SIM
    </button>

    <button class="btn-gray"
      onclick="
        document.getElementById('drinkModal').style.display='none';
        checkPayment();
      "
      style="margin-top:10px">
      N√ÉO
    </button>
  </div>
</div>

<div class="modal" id="changeModal" style="display:none">
  <div class="modal-box">
    <h3 style="text-align:center;margin-bottom:16px">
      Vai precisar de troco?
    </h3>

    <button class="btn-green" onclick="confirmChange(true)">SIM</button>
    <button class="btn-gray" onclick="confirmChange(false)" style="margin-top:10px">
      N√ÉO
    </button>
  </div>
</div>

<div class="modal" id="changeValueModal" style="display:none">
  <div class="modal-box">
    <h3 style="text-align:center;margin-bottom:16px">
      Troco para quanto?
    </h3>

    <input id="changeValue" class="search" placeholder="Ex: 50">

    <button class="btn-green" onclick="saveChangeValue()">
      Confirmar
    </button>
  </div>
</div>
<script>
/* ================= ADMIN PRE√áOS ================= */
function openAdmin(){
  if(document.getElementById("adminModal")) return;
  lockScroll();

  document.body.insertAdjacentHTML("beforeend", `
    <div class="modal" id="adminModal">
      <div class="modal-box">
        <div style="text-align:right;font-weight:900;cursor:pointer" onclick="closeAdmin()">‚úï</div>

        <h2 style="text-align:center;color:#5a0070">
          Painel Administrativo ‚Äî Pre√ßos
        </h2>

        <p style="text-align:center;font-size:13px;margin-bottom:14px">
          Alterar pre√ßos ou ocultar produtos
        </p>

        <div id="adminProducts"></div>
      </div>
    </div>
  `);

  renderAdmin();
}

function closeAdmin(){
  const m = document.getElementById("adminModal");
  if(m) m.remove();
  unlockScroll();
}

function renderAdmin(){
  const box = document.getElementById("adminProducts");
  box.innerHTML = "";

  Object.keys(products).forEach(cat=>{
    products[cat].forEach(p=>{
      const id = safeId(p.n);
      const price = customPrices[id] ?? p.p;
      const hidden = productStatus[id] === false;

      box.innerHTML += `
        <div style="border-bottom:1px dashed #ccc;padding:12px 0">
          <strong>${p.n}</strong>

          <input type="number" class="search" value="${price}" id="price_${id}">

          <button class="btn-green" onclick="savePrice('${id}')">
            Salvar Pre√ßo
          </button>

          <button class="btn-gray" onclick="toggleProduct('${id}')">
            ${hidden ? "Reativar Produto" : "Ocultar Produto"}
          </button>
        </div>
      `;
    });
  });
}

/* ================= A√á√ïES PRE√áOS ================= */
function savePrice(id){
  const v = document.getElementById("price_"+id).value;
  if(!v) return;
  if(!confirm("Confirmar altera√ß√£o de pre√ßo?")) return;

  db.ref("prices/"+id).set(Number(v),()=>{
    alert("Pre√ßo atualizado com sucesso");
  });
}

function toggleProduct(id){
  const hide = productStatus[id] !== false;
  if(!confirm(hide ? "Ocultar este produto?" : "Reativar este produto?")) return;

  db.ref("productStatus/"+id).set(!hide,()=>{
    alert(hide ? "Produto ocultado" : "Produto reativado");
  });
}
</script>

<script>
/* ================= ADMIN OFERTAS ================= */
function openOffer(){
  if(document.getElementById("offerModal")) return;
  lockScroll();

  document.body.insertAdjacentHTML("beforeend", `
    <div class="modal" id="offerModal">
      <div class="modal-box">
        <div style="text-align:right;font-weight:900;cursor:pointer" onclick="closeOffer()">‚úï</div>

        <h2 style="text-align:center;color:#b00020">
          Painel Administrativo ‚Äî Ofertas
        </h2>

        <p style="text-align:center;font-size:13px;margin-bottom:14px">
          Defina pre√ßo promocional e per√≠odo da oferta
        </p>

        <div id="offerProducts"></div>
      </div>
    </div>
  `);

  renderOfferAdmin();
}

function closeOffer(){
  const m = document.getElementById("offerModal");
  if(m) m.remove();
  unlockScroll();
}

function renderOfferAdmin(){
  const box = document.getElementById("offerProducts");
  box.innerHTML = "";

  Object.keys(products).forEach(cat=>{
    products[cat].forEach(p=>{
      const id = safeId(p.n);
      const offer = offers[id] || {};

      box.innerHTML += `
        <div style="border-bottom:1px dashed #ccc;padding:12px 0">
          <strong>${p.n}</strong>

          <input type="number" class="search"
            placeholder="Pre√ßo da oferta"
            id="offerPrice_${id}"
            value="${offer.price || ""}">

          <input type="date" class="search"
            id="offerStart_${id}"
            value="${offer.start || ""}">

          <input type="date" class="search"
            id="offerEnd_${id}"
            value="${offer.end || ""}">

          <button class="btn-green" onclick="saveOffer('${id}')">
            Salvar Oferta
          </button>

          <button class="btn-gray"
            style="margin-top:6px;background:#b00020;color:#fff"
            onclick="removeOffer('${id}')">
            Remover Oferta
          </button>
        </div>
      `;
    });
  });
}

function saveOffer(id){
  const price = document.getElementById("offerPrice_"+id).value;
  const start = document.getElementById("offerStart_"+id).value;
  const end = document.getElementById("offerEnd_"+id).value;

  if(!price || !start || !end){
    alert("Preencha pre√ßo e datas da oferta");
    return;
  }

  if(!confirm("Confirmar salvar esta oferta?")) return;

  db.ref("offers/"+id).set({
    price:Number(price),
    start:start,
    end:end
  },()=>{
    alert("Oferta salva com sucesso");
  });
}

function removeOffer(id){
  if(!confirm("Remover esta oferta?")) return;

  db.ref("offers/"+id).remove(()=>{
    alert("Oferta removida");
  });
}
</script>
<script>
/* ================= ADMIN BLOQUEIO DE PEDIDOS ================= */
function openBlockAdmin(){
  if(document.getElementById("blockModal")) return;
  lockScroll();

  document.body.insertAdjacentHTML("beforeend", `
    <div class="modal" id="blockModal">
      <div class="modal-box">
        <div style="text-align:right;font-weight:900;cursor:pointer" onclick="closeBlockAdmin()">‚úï</div>

        <h2 style="text-align:center;color:#b00020">
          Bloqueio de Pedidos
        </h2>

        <p style="text-align:center;font-size:13px;margin-bottom:14px">
          Ativar ou bloquear pedidos manualmente
        </p>

        <button class="btn-green" onclick="setOrderBlock(false)">
          üü¢ Ativar Pedidos
        </button>

        <button class="btn-gray"
          style="margin-top:10px;background:#b00020;color:#fff"
          onclick="setOrderBlock(true)">
          üîí Bloquear Pedidos
        </button>
      </div>
    </div>
  `);
}

function closeBlockAdmin(){
  const m = document.getElementById("blockModal");
  if(m) m.remove();
  unlockScroll();
}

function setOrderBlock(state){
  if(!confirm(state ? "Bloquear pedidos agora?" : "Ativar pedidos agora?")) return;

  db.ref("settings/orderBlocked").set(state,()=>{
    alert(state ? "Pedidos bloqueados com sucesso" : "Pedidos ativados com sucesso");
  });
}
</script>

<script>
/* ================= BUSCA / ATALHOS ADMIN ================= */
document.getElementById("search").addEventListener("keydown",function(e){
  if(e.key !== "Enter") return;

  const v = this.value.toLowerCase().trim();

  const adminKeys  = ["admin","pre√ßo","precos"];
  const offerKeys  = ["oferta","ofertas"];
  const reportKeys = ["relatorio","relat√≥rio"];
  const blockKeys  = ["bloqueio","bloquear"];

  if(
    !adminKeys.includes(v) &&
    !offerKeys.includes(v) &&
    !reportKeys.includes(v) &&
    !blockKeys.includes(v)
  ){
    return;
  }

  e.preventDefault();

  const senha = prompt("Senha do administrador:");
  if(senha !== ADMIN_PASSWORD){
    alert("Senha incorreta");
    this.value = "";
    return;
  }

  if(adminKeys.includes(v))  openAdmin();
  if(offerKeys.includes(v))  openOffer();
  if(reportKeys.includes(v)) openReport();
  if(blockKeys.includes(v))  openBlockAdmin();

  this.value = "";
});
</script>

<script>
/* ================= RELAT√ìRIO DE VENDAS ================= */
function openReport(){
  if(document.getElementById("reportModal")) return;
  lockScroll();

  document.body.insertAdjacentHTML("beforeend",`
    <div class="modal" id="reportModal">
      <div class="modal-box">
        <div style="text-align:right;font-weight:900;cursor:pointer" onclick="closeReport()">‚úï</div>

        <h2 style="text-align:center;color:#5a0070">
          Relat√≥rio de Vendas ‚Äî Hoje
        </h2>

        <div id="reportContent" style="margin-top:14px"></div>
      </div>
    </div>
  `);

  renderReport();
}

function closeReport(){
  const m = document.getElementById("reportModal");
  if(m) m.remove();
  unlockScroll();
}

function renderReport(){
  const box = document.getElementById("reportContent");
  if(!box) return;

  const today = new Date().toISOString().split("T")[0];

  let total = 0;
  let dinheiro = 0;
  let pix = 0;
  let debito = 0;
  let credito = 0;

  Object.values(sales || {}).forEach(s=>{
    if(!s.date || !s.date.startsWith(today)) return;

    total += s.total || 0;
    const p = (s.payment || "").toLowerCase();

    if(p.includes("dinheiro")) dinheiro += s.total || 0;
    else if(p.includes("pix")) pix += s.total || 0;
    else if(p.includes("debito")) debito += s.total || 0;
    else if(p.includes("credito")) credito += s.total || 0;
  });

  box.innerHTML = `
    <div style="font-weight:900;margin-bottom:10px">
      Total vendido hoje: R$ ${total.toFixed(2).replace(".",",")}
    </div>
    <div>üíµ Dinheiro: R$ ${dinheiro.toFixed(2).replace(".",",")}</div>
    <div>‚ö° Pix: R$ ${pix.toFixed(2).replace(".",",")}</div>
    <div>üí≥ D√©bito: R$ ${debito.toFixed(2).replace(".",",")}</div>
    <div>üí≥ Cr√©dito: R$ ${credito.toFixed(2).replace(".",",")}</div>
  `;
}
</script>
<script>
/* ================= CONTROLE DE SCROLL ================= */
function lockScroll(){
  document.body.style.overflow = "hidden";
}

function unlockScroll(){
  document.body.style.overflow = "auto";
}
</script>

<script>
/* ================= GARANTIA DE ESTADO INICIAL ================= */
window.addEventListener("load", ()=>{

  /* App sempre inicia na splash */
  const splash = document.getElementById("splash");
  const app = document.getElementById("app");

  if(splash) splash.style.display = "flex";
  if(app) app.style.display = "none";

  /* Nenhuma aba aberta automaticamente */
  document.querySelectorAll(".box").forEach(b=>{
    b.classList.remove("active");
  });

  document.querySelectorAll(".tab").forEach(t=>{
    t.classList.remove("active");
  });

  /* Carrinho fechado por padr√£o */
  cartOpen = false;

});
</script>

</body>
</html>


