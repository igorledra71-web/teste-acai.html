<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Rabika's Burguer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(180deg,#06003a,#0a045a,#03001f);
  color:#fff;
  display:flex;
  justify-content:center;
}

/* SPLASH */
#splash{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#05002e,#020018);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.splash-box{text-align:center}
.splash-logo{width:260px;max-width:80%;margin-bottom:28px}
.splash-btn{
  background:linear-gradient(135deg,#FFD34D,#FFB000);
  border:none;
  padding:18px 56px;
  border-radius:44px;
  font-size:22px;
  font-weight:900;
  color:#2b0033;
  cursor:pointer;
}

/* APP */
#app{
  width:100%;
  max-width:420px;
  padding:16px 16px 320px;
  display:none;
}
.title{text-align:center;font-size:30px;font-weight:900;color:#FFD34D}
#status{text-align:center;font-size:13px;margin-bottom:6px}
#hours{text-align:center;font-size:12px;margin-bottom:12px;color:#FFD34D}

/* BUSCA */
.search{
  width:100%;
  padding:14px 16px;
  border-radius:22px;
  border:none;
  font-size:15px;
  margin-bottom:14px;
}

/* TABS */
.tabs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.tab{
  background:#fff;
  color:#2b0033;
  padding:10px 6px;
  border-radius:18px;
  font-weight:800;
  text-align:center;
  cursor:pointer;
  font-size:12px;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.tab span{font-size:18px}
.tab.active{background:#FFD34D;transform:scale(1.05)}

/* BOX */
.box{
  background:#fff;
  color:#2b0033;
  border-radius:26px;
  padding:16px;
  margin-top:14px;
  display:none;
}
.box.active{display:block}

/* ITEM */
.item{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:8px;
  padding:10px 0;
  border-bottom:1px dashed #ddd;
}
.item:last-child{border:none}
.item-price{font-weight:900;color:#5a0070}
.btn-add{
  background:#5a0070;
  color:#fff;
  border:none;
  border-radius:12px;
  padding:6px 12px;
  font-weight:900;
}

/* SE√á√ïES */
.section{font-weight:900;margin:10px 0;color:#5a0070}

/* CARRINHO */
#cart{
  position:fixed;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:100%;
  max-width:420px;
  background:#fff;
  color:#2b0033;
  padding:16px;
  border-radius:26px 26px 0 0;
  display:none;
}
.cart-item{display:flex;justify-content:space-between;margin-bottom:6px}
.btn-green{
  background:#25D366;
  color:#fff;
  border:none;
  padding:14px;
  border-radius:22px;
  font-weight:900;
  width:100%;
}

/* MODAIS */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
}
.modal-box{
  background:#fff;
  color:#2b0033;
  width:92%;
  max-width:420px;
  border-radius:26px;
  padding:20px;
  max-height:85vh;
  overflow-y:auto;
  position:relative;
}
.modal-close{
  position:absolute;
  top:10px;
  right:14px;
  font-size:22px;
  font-weight:900;
  cursor:pointer;
}
</style>
</head>

<body>
<script>
/* ================= CONFIGURA√á√ïES ================= */
const ADMIN_PASSWORD = "1234";
const FREIGHT = 8;

let cart = [];
let currentTab = null;

/* ================= STORAGE ================= */
let customPrices = JSON.parse(localStorage.getItem("customPrices")) || {};
let productStatus = JSON.parse(localStorage.getItem("productStatus")) || {};
let extraProducts = JSON.parse(localStorage.getItem("extraProducts")) || {};
let offers = JSON.parse(localStorage.getItem("offers")) || {};
let sales = JSON.parse(localStorage.getItem("sales")) || [];

/* ================= HOR√ÅRIO DE FUNCIONAMENTO ================= */
function isOpen(){
  const d = new Date();
  const day = d.getDay(); // 0 domingo | 1 segunda
  const h = d.getHours() + d.getMinutes()/60;

  if(day === 1) return false;
  if(h < 18.5 || h > 22.5) return false;
  return true;
}

/* ================= PRODUTOS BASE ================= */
const products = {
  lanches:[
    {n:"X-Salada",p:17},
    {n:"X-Burguer",p:14},
    {n:"X-Frango",p:22},
    {n:"X-Frango Cremoso",p:20},
    {n:"X-Bacon",p:25},
    {n:"X-Calabresa",p:25},
    {n:"X-Cora√ß√£o",p:27},
    {n:"X-Tudo",p:32},
    {n:"X-Burguer Duplo",p:22},
    {n:"X-Egg",p:20},
    {n:"X-Tribom",p:32},
    {n:"X-Da Casa",p:45},
    {n:"X-Dog",p:20}
  ],

  adicionaisLanches:[
    {n:"Calabresa",p:7},
    {n:"Bacon",p:7},
    {n:"Cora√ß√£o",p:8},
    {n:"Ovo",p:3},
    {n:"Salsicha",p:4},
    {n:"Frango",p:7},
    {n:"Cheddar",p:4},
    {n:"Hamb√∫rguer artesanal",p:10},
    {n:"Maionese caseira",p:2}
  ],

  porcoes:[
    {n:"Fritas c/ Frango",p:39.99},
    {n:"Fritas",p:24.99},
    {n:"Fritas c/ Calabresa",p:34.99},
    {n:"Fritas c/ Bacon",p:34.99},
    {n:"An√©is de Cebola",p:24.99},
    {n:"Fritas c/ Bacon, Calabresa e Queijo",p:39.99},
    {n:"Fritas c/ Bacon Cheddar",p:39.99},
    {n:"Fritas c/ Polenta e Frango",p:39.99},
    {n:"Fritas c/ Polenta",p:24.99},
    {n:"Fritas c/ Calabresa e Catupiry",p:35.99},
    {n:"Fritas, Polenta, Chuleta e Anel de Cebola",p:49.99}
  ],

  pasteis:[
    {n:"Pastel de Carne",p:14},
    {n:"Pastel de Frango",p:12},
    {n:"Frango Bacon Cheddar",p:16},
    {n:"Bacon Cheddar",p:15},
    {n:"Calabresa c/ Cebola",p:14},
    {n:"Carne e Queijo",p:15},
    {n:"Queijo",p:14},
    {n:"Chocolate ao Leite",p:15},
    {n:"Banana Queijo Canela",p:15},
    {n:"Romeu e Julieta",p:15},
    {n:"Chocolate Branco",p:15},
    {n:"Creme e Ouro Branco",p:15},
    {n:"Creme e Sonho de Valsa",p:15}
  ],

  acaiTamanhos:[
    {n:"A√ßa√≠ 300ml",p:12},
    {n:"A√ßa√≠ 400ml",p:15},
    {n:"A√ßa√≠ 500ml",p:18}
  ],

  acaiAdicionais:[
    {n:"Pa√ßoca",p:2},
    {n:"Leite em p√≥",p:4},
    {n:"Granola",p:4},
    {n:"Morango",p:4},
    {n:"M&M",p:3},
    {n:"Ouro Branco",p:3},
    {n:"Banana",p:2},
    {n:"Sonho de Valsa",p:3},
    {n:"Leite Condensado",p:3},
    {n:"Nutella",p:4}
  ],

  bebidas:[
    {n:"Cassulinha 200ml",p:3},
    {n:"Coca-Cola 600ml",p:8},
    {n:"Coca-Cola 2L",p:16},
    {n:"Refri Lata",p:6},
    {n:"Refrigerante 2L",p:12},
    {n:"Cerveja Lata 350ml",p:6},
    {n:"Achocolatado 200ml",p:3}
  ]
};

/* ================= UNIFICA√á√ÉO DE PRODUTOS ================= */
function getAllProducts(){
  let all = JSON.parse(JSON.stringify(products));
  Object.keys(extraProducts).forEach(cat=>{
    all[cat] = (all[cat] || []).concat(extraProducts[cat]);
  });
  return all;
}

/* ================= PRE√áO FINAL ================= */
function getPrice(p){
  const basePrice = customPrices[p.n] ?? p.p;
  const o = offers[p.n];

  if(o){
    const today = new Date().toISOString().split("T")[0];
    if(today >= o.start && today <= o.end){
      return o.price;
    }
  }
  return basePrice;
}
</script>
<script>
/* ================= START ================= */
function start(){
  document.getElementById("splash").style.display = "none";
  document.getElementById("app").style.display = "block";

  document.getElementById("status").innerText =
    isOpen() ? "üü¢ Aberto agora" : "üî¥ Fechado ‚Äî pedidos indispon√≠veis";

  renderAll();
}

/* ================= RENDER GERAL ================= */
function renderAll(){
  const all = getAllProducts();
  renderCategory("lanches", all.lanches, all.adicionaisLanches);
  renderCategory("porcoes", all.porcoes);
  renderCategory("pasteis", all.pasteis);
  renderAcai(all);
  renderCategory("bebidas", all.bebidas);
}

/* ================= RENDER CATEGORIA ================= */
function renderCategory(id, list, extras){
  const box = document.getElementById(id);
  box.innerHTML = "";

  list.forEach(p=>{
    if(productStatus[p.n] === false) return;
    box.innerHTML += itemHTML(p);
  });

  if(extras){
    box.innerHTML += `<div class="section">‚ûï Adicionais</div>`;
    extras.forEach(p=>{
      if(productStatus[p.n] !== false){
        box.innerHTML += itemHTML(p);
      }
    });
  }
}

/* ================= RENDER A√áA√ç ================= */
function renderAcai(all){
  const box = document.getElementById("acai");
  box.innerHTML = "";

  box.innerHTML += `<div class="section">ü•§ Tamanhos</div>`;
  all.acaiTamanhos.forEach(p=>{
    if(productStatus[p.n] !== false){
      box.innerHTML += itemHTML(p);
    }
  });

  box.innerHTML += `<div class="section">üç´ Adicionais</div>`;
  all.acaiAdicionais.forEach(p=>{
    if(productStatus[p.n] !== false){
      box.innerHTML += itemHTML(p);
    }
  });
}

/* ================= ITEM ================= */
function itemHTML(p){
  const price = getPrice(p);
  return `
    <div class="item" data-name="${p.n.toLowerCase()}">
      <span>${p.n}</span>
      <span class="item-price">R$ ${price.toFixed(2).replace(".",",")}</span>
      <button class="btn-add" onclick="addItem('${p.n}',${price})">+</button>
    </div>
  `;
}

/* ================= ABAS (TOGGLE) ================= */
function openTab(id, el){
  const box = document.getElementById(id);
  const isActive = box.classList.contains("active");

  document.querySelectorAll(".box").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));

  if(!isActive){
    box.classList.add("active");
    el.classList.add("active");
    currentTab = id;
  }else{
    currentTab = null;
  }
}

/* ================= BUSCA & ATALHOS (CORRIGIDO) ================= */
document.getElementById("search").addEventListener("input", function(){
  const raw = this.value;
  const v = raw.toLowerCase().trim();

  /* ---------- ATALHOS ADMINISTRATIVOS (PRIORIDADE) ---------- */
  if(
    v === "admin" ||
    v === "pre√ßo" ||
    v === "precos"
  ){
    const s = prompt("Senha do administrador:");
    if(s === ADMIN_PASSWORD){
      openAdmin();
    }else{
      alert("Senha incorreta");
    }
    this.value = "";
    return;
  }

  if(v === "oferta" || v === "ofertas"){
    const s = prompt("Senha do administrador:");
    if(s === ADMIN_PASSWORD){
      openOffer();
    }else{
      alert("Senha incorreta");
    }
    this.value = "";
    return;
  }

  if(v === "relatorio" || v === "relat√≥rio"){
    const s = prompt("Senha do administrador:");
    if(s === ADMIN_PASSWORD){
      openReport();
    }else{
      alert("Senha incorreta");
    }
    this.value = "";
    return;
  }

  /* ---------- BUSCA DE PRODUTOS ---------- */
  let foundTab = null;

  document.querySelectorAll(".item").forEach(item=>{
    const match = item.dataset.name.includes(v);
    item.style.display = match ? "grid" : "none";

    if(match && !foundTab){
      foundTab = item.closest(".box").id;
    }
  });

  if(foundTab){
    const tab = [...document.querySelectorAll(".tab")]
      .find(t => t.getAttribute("onclick").includes(foundTab));
    if(tab) openTab(foundTab, tab);
  }

  if(!v){
    document.querySelectorAll(".item").forEach(i=>{
      i.style.display = "grid";
    });
  }
});
</script>
<script>
/* ================= CARRINHO ================= */
function addItem(name, price){
  if(!isOpen()){
    alert("Estamos fechados no momento.\nTer√ßa a Domingo das 18:30 √†s 22:30");
    return;
  }
  cart.push({name, price});
  updateCart();
}

function updateCart(){
  const box = document.getElementById("cartItems");
  box.innerHTML = "";
  let totalValue = 0;

  cart.forEach((item)=>{
    totalValue += item.price;
    box.innerHTML += `
      <div class="cart-item">
        <span>${item.name}</span>
        <span>R$ ${item.price.toFixed(2).replace(".",",")}</span>
      </div>
    `;
  });

  document.getElementById("total").innerText =
    "Total: R$ " + totalValue.toFixed(2).replace(".",",");

  document.getElementById("cart").style.display =
    cart.length ? "block" : "none";
}

/* ================= WHATSAPP ================= */
function sendOrder(){
  if(!cart.length){
    alert("Seu carrinho est√° vazio");
    return;
  }

  const payment =
    prompt("Forma de pagamento? (dinheiro / pix / debito / credito)") || "dinheiro";

  let message = "üçî Pedido Rabika's Burguer\n\n";
  let total = 0;

  cart.forEach(i=>{
    message += `- ${i.name} R$ ${i.price.toFixed(2).replace(".",",")}\n`;
    total += i.price;
  });

  message += `\nPagamento: ${payment}`;
  message += `\nTotal: R$ ${total.toFixed(2).replace(".",",")}`;

  sales.push({
    date: new Date().toISOString(),
    total: total,
    payment: payment.toLowerCase()
  });
  localStorage.setItem("sales", JSON.stringify(sales));

  const phone = "554991789706";
  const url =
    "https://wa.me/" + phone + "?text=" + encodeURIComponent(message);
  window.open(url, "_blank");

  cart = [];
  updateCart();
}

/* ================= BLOCO 8 ‚Äî ADMIN ================= */
function openAdmin(){
  document.getElementById("adminModal").style.display = "flex";
  renderAdmin();
}
function closeAdmin(){
  document.getElementById("adminModal").style.display = "none";
}

function renderAdmin(){
  const active = document.getElementById("adminActive");
  const hidden = document.getElementById("adminHidden");
  active.innerHTML = "";
  hidden.innerHTML = "";

  const all = getAllProducts();

  Object.keys(all).forEach(cat=>{
    all[cat].forEach(p=>{
      const price = getPrice(p);
      const isHidden = productStatus[p.n] === false;

      const html = `
        <div style="margin-bottom:12px">
          <strong>${p.n}</strong>
          <input type="number" class="search"
            value="${price}" id="price-${p.n}">
          <button class="btn-green"
            onclick="savePrice('${p.n}')">Salvar</button>
          <button class="btn-green" style="background:#999"
            onclick="toggleProduct('${p.n}')">
            ${isHidden ? "Reativar" : "Ocultar"}
          </button>
        </div>
      `;

      if(isHidden) hidden.innerHTML += html;
      else active.innerHTML += html;
    });
  });
}

function savePrice(name){
  const v = document.getElementById("price-"+name).value;
  customPrices[name] = Number(v);
  localStorage.setItem("customPrices", JSON.stringify(customPrices));
  renderAll();
}

function toggleProduct(name){
  productStatus[name] =
    productStatus[name] === false ? true : false;
  localStorage.setItem(
    "productStatus", JSON.stringify(productStatus)
  );
  renderAll();
  renderAdmin();
}

function addNewProduct(){
  const n = document.getElementById("newName").value.trim();
  const p = Number(document.getElementById("newPrice").value);
  const c = document.getElementById("newCategory").value;

  if(!n || !p || !c){
    alert("Preencha todos os campos");
    return;
  }

  if(!extraProducts[c]) extraProducts[c] = [];
  extraProducts[c].push({n,p});
  localStorage.setItem(
    "extraProducts", JSON.stringify(extraProducts)
  );

  document.getElementById("newName").value = "";
  document.getElementById("newPrice").value = "";
  document.getElementById("newCategory").value = "";

  renderAll();
  renderAdmin();
}

/* ================= OFERTAS ================= */
function openOffer(){
  document.getElementById("offerModal").style.display = "flex";
  renderOffers();
}
function closeOffer(){
  document.getElementById("offerModal").style.display = "none";
}

function renderOffers(){
  const box = document.getElementById("offerList");
  box.innerHTML = "";

  const all = getAllProducts();

  Object.keys(all).forEach(cat=>{
    all[cat].forEach(p=>{
      const o = offers[p.n] || {};

      box.innerHTML += `
        <div style="margin-bottom:16px">
          <strong>${p.n}</strong>

          <input class="search" type="number"
            placeholder="Valor de oferta"
            value="${o.price ?? ""}"
            id="offerPrice-${p.n}">

          <input class="search" type="date"
            value="${o.start ?? ""}"
            id="offerStart-${p.n}">

          <input class="search" type="date"
            value="${o.end ?? ""}"
            id="offerEnd-${p.n}">

          <button class="btn-green"
            onclick="saveOffer('${p.n}')">
            Salvar Oferta
          </button>

          ${
            offers[p.n]
              ? `<button class="btn-green"
                   style="background:#999;margin-top:6px"
                   onclick="removeOffer('${p.n}')">
                   Remover Oferta</button>`
              : ""
          }
        </div>
      `;
    });
  });
}

function saveOffer(name){
  const price =
    Number(document.getElementById("offerPrice-"+name).value);
  const start =
    document.getElementById("offerStart-"+name).value;
  const end =
    document.getElementById("offerEnd-"+name).value;

  if(!price || !start || !end){
    alert("Preencha valor e datas");
    return;
  }

  offers[name] = { price, start, end };
  localStorage.setItem("offers", JSON.stringify(offers));
  renderAll();
  renderOffers();
}

function removeOffer(name){
  delete offers[name];
  localStorage.setItem("offers", JSON.stringify(offers));
  renderAll();
  renderOffers();
}

/* ================= RELAT√ìRIO ================= */
function openReport(){
  document.getElementById("reportModal").style.display = "flex";
  renderReport();
}
function closeReport(){
  document.getElementById("reportModal").style.display = "none";
}

function renderReport(){
  let total = 0, cash = 0, pix = 0, debit = 0, credit = 0;

  sales.forEach(s=>{
    total += s.total;
    if(s.payment === "dinheiro") cash += s.total;
    if(s.payment === "pix") pix += s.total;
    if(s.payment === "debito") debit += s.total;
    if(s.payment === "credito") credit += s.total;
  });

  document.getElementById("repTotal").innerText =
    "R$ " + total.toFixed(2).replace(".",",");
  document.getElementById("repCash").innerText =
    "R$ " + cash.toFixed(2).replace(".",",");
  document.getElementById("repPix").innerText =
    "R$ " + pix.toFixed(2).replace(".",",");
  document.getElementById("repDebit").innerText =
    "R$ " + debit.toFixed(2).replace(".",",");
  document.getElementById("repCredit").innerText =
    "R$ " + credit.toFixed(2).replace(".",",");
}
</script>

</body>
</html>
