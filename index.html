<!DOCTYPE html>
<div id="acaiTamanhos" style="display:none;">


<div class="item" data-prod="A√ßa√≠ 300ml" data-price="12">
<span>300ml</span>
<span class="price">R$ 12,00</span>
<button class="btn-add" onclick="addToCart('A√ßa√≠ 300ml',12)">+</button>
</div>


<div class="item" data-prod="A√ßa√≠ 400ml" data-price="15">
<span>400ml</span>
<span class="price">R$ 15,00</span>
<button class="btn-add" onclick="addToCart('A√ßa√≠ 400ml',15)">+</button>
</div>


<div class="item" data-prod="A√ßa√≠ 500ml" data-price="18">
<span>500ml</span>
<span class="price">R$ 18,00</span>
<button class="btn-add" onclick="addToCart('A√ßa√≠ 500ml',18)">+</button>
</div>


</div>


<!-- ADICIONAIS -->
<div class="sub-btn" onclick="toggle('acaiAdicionais')">üç´ Adicionais</div>
<div id="acaiAdicionais" style="display:none;">


<div class="item" data-prod="Pa√ßoca" data-price="2">
<span>Pa√ßoca</span>
<span class="price">R$ 2,00</span>
<button class="btn-add" onclick="addToCart('Pa√ßoca',2)">+</button>
</div>


<div class="item" data-prod="Leite em p√≥" data-price="4">
<span>Leite em p√≥</span>
<span class="price">R$ 4,00</span>
<button class="btn-add" onclick="addToCart('Leite em p√≥',4)">+</button>
</div>


<div class="item" data-prod="Granola" data-price="4">
<span>Granola</span>
<span class="price">R$ 4,00</span>
<button class="btn-add" onclick="addToCart('Granola',4)">+</button>
</div>


<div class="item" data-prod="Morango" data-price="4">
<span>Morango</span>
<span class="price">R$ 4,00</span>
<button class="btn-add" onclick="addToCart('Morango',4)">+</button>
</div>


<div class="item" data-prod="M&M" data-price="3">
<span>M&amp;M</span>
<span class="price">R$ 3,00</span>
<button class="btn-add" onclick="addToCart('M&M',3)">+</button>
</div>


<div class="item" data-prod="Ouro Branco" data-price="3">
<span>Ouro Branco</span>
<span class="price">R$ 3,00</span>
<button class="btn-add" onclick="addToCart('Ouro Branco',3)">+</button>
</div>


<div class="item" data-prod="Banana" data-price="2">
<span>Banana</span>
<span class="price">R$ 2,00</span>
<button class="btn-add" onclick="addToCart('Banana',2)">+</button>
</div>


<div class="item" data-prod="Sonho de Valsa" data-price="3">
<span>Sonho de Valsa</span>
<span class="price">R$ 3,00</span>
<button class="btn-add" onclick="addToCart('Sonho de Valsa',3)">+</button>
</div>


<div class="item" data-prod="Leite Condensado" data-price="3">
<span>Leite Condensado</span>
<span class="price">R$ 3,00</span>
<button class="btn-add" onclick="addToCart('Leite Condensado',3)">+</button>
</div>


<div class="item" data-prod="Nutella" data-price="4">
<span>Nutella</span>
<span class="price">R$ 4,00</span>
<button class="btn-add" onclick="addToCart('Nutella',4)">+</button>
</div>


</div>
</div>


<!-- ================= FIM PARTE 6 ================= -->
<!-- ================= PARTE 7 ‚Äì CARRINHO / PAGAMENTO ================= -->

<div class="cart-footer" id="cartFooter">

  <!-- ITENS DO CARRINHO -->
  <div id="cartItems"></div>

  <!-- ENTREGA / RETIRADA -->
  <div class="delivery-box" style="display:flex;justify-content:space-around;margin:12px 0;">
    <label>
      <input type="radio" name="entrega" checked onchange="setDelivery(false)">
      Retirada
    </label>
    <label>
      <input type="radio" name="entrega" onchange="setDelivery(true)">
      Entrega (+ R$ 8,00)
    </label>
  </div>

  <!-- NOME DO CLIENTE -->
  <input
    class="input-field"
    id="clientName"
    placeholder="Seu nome">

  <!-- ENDERE√áO (S√ì SE ENTREGA) -->
  <div id="addressBox" style="display:none;">
    <input
      class="input-field"
      id="clientAddress"
      placeholder="Endere√ßo para entrega">
  </div>

  <!-- FORMA DE PAGAMENTO -->
  <select
    class="select-field"
    id="paymentMethod"
    onchange="checkPayment()">
    <option value="">Forma de pagamento</option>
    <option value="Dinheiro">Dinheiro</option>
    <option value="Pix">Pix</option>
    <option value="Cart√£o D√©bito">Cart√£o D√©bito</option>
    <option value="Cart√£o Cr√©dito">Cart√£o Cr√©dito</option>
  </select>

  <!-- TROCO -->
  <div id="trocoBox" style="display:none;margin-top:8px;">

    <div style="display:flex;gap:10px;">
      <button
        class="btn-add"
        style="background:#FFD34D;color:#2b0033;flex:1"
        onclick="setTroco(true)">
        Preciso de troco
      </button>

      <button
        class="btn-add"
        style="background:#ccc;color:#2b0033;flex:1"
        onclick="setTroco(false)">
        N√£o preciso
      </button>
    </div>

    <input
      class="input-field"
      id="trocoValue"
      placeholder="Troco para quanto? Ex: 50,00"
      style="display:none;">
  </div>

  <!-- TOTAL -->
  <div class="total" id="totalValue">
    Total: R$ 0,00
  </div>

  <!-- FINALIZAR PEDIDO -->
  <div class="btn-finish" onclick="finishOrder()">
    Finalizar Pedido
  </div>

</div>

<!-- ================= FIM PARTE 7 ================= -->
<!-- ================= PARTE 8 ‚Äì JS CARRINHO / PAGAMENTO ================= -->
<script>
/* ================= VARI√ÅVEIS ================= */
let cart = [];
let isDelivery = false;
let needTroco = false;
const deliveryFee = 8;

/* ================= ADICIONAR AO CARRINHO ================= */
function addToCart(name, price){
  cart.push({ name, price });
  updateCart();
}

/* ================= ATUALIZAR CARRINHO ================= */
function updateCart(){
  const cartItems = document.getElementById("cartItems");
  const cartFooter = document.getElementById("cartFooter");
  const totalValue = document.getElementById("totalValue");

  cartItems.innerHTML = "";
  let total = 0;

  cart.forEach((item, index)=>{
    total += item.price;

    const div = document.createElement("div");
    div.style.display = "flex";
    div.style.justifyContent = "space-between";
    div.style.marginBottom = "6px";

    div.innerHTML = `
      <span>${item.name}</span>
      <span>
        R$ ${item.price.toFixed(2).replace('.',',')}
        <button onclick="removeItem(${index})" style="margin-left:8px">‚úï</button>
      </span>
    `;

    cartItems.appendChild(div);
  });

  if(isDelivery) total += deliveryFee;

  totalValue.innerHTML = "Total: R$ " + total.toFixed(2).replace('.',',');

  cartFooter.style.display = cart.length > 0 ? "block" : "none";
}

/* ================= REMOVER ITEM ================= */
function removeItem(index){
  cart.splice(index, 1);
  updateCart();
}

/* ================= ENTREGA / RETIRADA ================= */
function setDelivery(value){
  isDelivery = value;
  document.getElementById("addressBox").style.display = value ? "block" : "none";
  updateCart();
}

/* ================= FORMA DE PAGAMENTO ================= */
function checkPayment(){
  const payment = document.getElementById("paymentMethod").value;
  const trocoBox = document.getElementById("trocoBox");

  trocoBox.style.display = payment === "Dinheiro" ? "block" : "none";
}

/* ================= TROCO ================= */
function setTroco(value){
  needTroco = value;
  document.getElementById("trocoValue").style.display = value ? "block" : "none";
}

/* ================= FINALIZAR PEDIDO ================= */
function finishOrder(){
  const name = document.getElementById("clientName").value.trim();
  const address = document.getElementById("clientAddress").value.trim();
  const payment = document.getElementById("paymentMethod").value;
  const troco = document.getElementById("trocoValue").value;

  if(cart.length === 0) return alert("Carrinho vazio");
  if(!name) return alert("Informe seu nome");
  if(isDelivery && !address) return alert("Informe o endere√ßo");
  if(!payment) return alert("Informe a forma de pagamento");

  let total = 0;
  let text = `üçî *NOVO PEDIDO*\\n\\nüë§ ${name}\\n\\n`;

  cart.forEach(item=>{
    total += item.price;
    text += `‚Ä¢ ${item.name} - R$ ${item.price.toFixed(2).replace('.',',')}\\n`;
  });

  if(isDelivery){
    total += deliveryFee;
    text += `\\nüöö Entrega: R$ ${deliveryFee.toFixed(2).replace('.',',')}`;
    text += `\\nüìç Endere√ßo: ${address}`;
  }else{
    text += `\\nüèÉ Retirada no local`;
  }

  text += `\\n\\nüí≥ Pagamento: ${payment}`;

  if(payment === "Dinheiro"){
    text += needTroco
      ? `\\nüíµ Troco para: R$ ${troco}`
      : `\\nüíµ Sem troco`;
  }

  text += `\\n\\nüí∞ *Total: R$ ${total.toFixed(2).replace('.',',')}*`;

  const url = `https://wa.me/55SEUNUMEROAQUI?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");

  /* RESET */
  cart = [];
  updateCart();
  document.getElementById("clientName").value = "";
  document.getElementById("clientAddress").value = "";
  document.getElementById("paymentMethod").value = "";
  document.getElementById("trocoValue").value = "";
}
</script>

<!-- ================= FIM PARTE 8 ================= -->
<!-- ================= PARTE 9 ‚Äì PAINEL ADMIN / OFERTAS ================= -->

<!-- OVERLAY ADMIN -->
<div id="adminOverlay">
  <div class="admin-panel" id="adminPanel">

    <div class="admin-header">
      <span>üî• Painel de Ofertas</span>
      <button onclick="closeAdmin()">‚úï</button>
    </div>

    <div class="admin-body">

      <label>Produto</label>
      <select id="offerProduct"></select>

      <label>Pre√ßo Promocional</label>
      <input type="number" id="offerPrice" step="0.01" placeholder="Ex: 19.90">

      <label>In√≠cio da Oferta</label>
      <input type="datetime-local" id="offerStart">

      <label>Fim da Oferta</label>
      <input type="datetime-local" id="offerEnd">

      <button class="btn-add" onclick="saveOffer()" style="margin-top:12px">
        Salvar Oferta
      </button>

    </div>

  </div>
</div>

<style>
/* ================= ESTILO ADMIN ================= */
#adminOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter: blur(4px);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:99999;
}

.admin-panel{
  width:92%;
  max-width:420px;
  background:#fff;
  color:#2b0033;
  border-radius:22px;
  animation: slideUp .35s ease;
}

.admin-header{
  background:#FFD34D;
  padding:16px;
  font-weight:900;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-radius:22px 22px 0 0;
}

.admin-header button{
  background:none;
  border:none;
  font-size:20px;
  font-weight:900;
  cursor:pointer;
}

.admin-body{
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.admin-body input,
.admin-body select{
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}

@keyframes slideUp{
  from{transform:translateY(80px);opacity:0}
  to{transform:translateY(0);opacity:1}
}
</style>

<script>
/* ================= OFERTAS (ADMIN) ================= */
let offers = JSON.parse(localStorage.getItem("offers")) || {};

/* ABRIR ADMIN */
function openAdmin(){
  document.getElementById("adminOverlay").style.display = "flex";
  loadOfferProducts();
}

/* FECHAR ADMIN */
function closeAdmin(){
  document.getElementById("adminOverlay").style.display = "none";
}

/* CARREGAR PRODUTOS */
function loadOfferProducts(){
  const select = document.getElementById("offerProduct");
  select.innerHTML = "";

  document.querySelectorAll(".item").forEach(item=>{
    const prod = item.getAttribute("data-prod");
    const price = item.getAttribute("data-price");

    if(prod && price){
      const opt = document.createElement("option");
      opt.value = prod;
      opt.textContent = prod;
      select.appendChild(opt);
    }
  });
}

/* SALVAR OFERTA */
function saveOffer(){
  const product = offerProduct.value;
  const price = parseFloat(offerPrice.value);
  const start = offerStart.value;
  const end = offerEnd.value;

  if(!product || !price || !start || !end){
    alert("Preencha todos os campos");
    return;
  }

  offers[product] = { price, start, end };
  localStorage.setItem("offers", JSON.stringify(offers));

  alert("Oferta salva com sucesso");
  applyOffers();
}

/* APLICAR OFERTAS */
function applyOffers(){
  const now = new Date();

  document.querySelectorAll(".item").forEach(item=>{
    const prod = item.getAttribute("data-prod");
    const basePrice = parseFloat(item.getAttribute("data-price"));
    const offer = offers[prod];
    const priceEl = item.querySelector(".price");
    const btn = item.querySelector(".btn-add");

    if(!offer){
      priceEl.innerHTML = "R$ " + basePrice.toFixed(2).replace('.',',');
      btn.setAttribute("onclick",`addToCart('${prod}',${basePrice})`);
      return;
    }

    const start = new Date(offer.start);
    const end = new Date(offer.end);

    if(now >= start && now <= end){
      priceEl.innerHTML = `
        <span class="old-price">R$ ${basePrice.toFixed(2).replace('.',',')}</span><br>
        <span>R$ ${offer.price.toFixed(2).replace('.',',')}</span>
        <span class="offer-badge">OFERTA</span>
      `;
      btn.setAttribute("onclick",`addToCart('${prod}',${offer.price})`);
    }else{
      priceEl.innerHTML = "R$ " + basePrice.toFixed(2).replace('.',',');
      btn.setAttribute("onclick",`addToCart('${prod}',${basePrice})`);
    }
  });
}

/* APLICAR AO CARREGAR */
document.addEventListener("DOMContentLoaded", applyOffers);

/* ================= GANCHO NA BUSCA ================= */
const _searchOriginal = searchProduct;
searchProduct = function(q){
  const term = q.toLowerCase().trim();

  if(term === "ofertas"){
    if(prompt("Senha ADM") === "adm"){
      openAdmin();
    }else{
      alert("Senha incorreta");
    }
    document.getElementById("searchInput").value = "";
    return;
  }

  _searchOriginal(q);
};

/* FECHAR AO CLICAR FORA */
document.addEventListener("click", e=>{
  const overlay = document.getElementById("adminOverlay");
  const panel = document.getElementById("adminPanel");

  if(overlay.style.display === "flex" && !panel.contains(e.target)){
    closeAdmin();
  }
});
</script>

<!-- ================= FIM PARTE 9 ================= -->
<!-- ================= PARTE 10 ‚Äì RELAT√ìRIO DE VENDAS ================= -->

<script>
/* ================= ESTRUTURA DE VENDAS ================= */
function getSales(){
  return JSON.parse(localStorage.getItem("sales")) || {
    dinheiro: 0,
    pix: 0,
    debito: 0,
    credito: 0,
    total: 0
  };
}

function saveSale(valor, metodo){
  let sales = getSales();

  sales.total += valor;

  if(metodo === "Dinheiro") sales.dinheiro += valor;
  if(metodo === "Pix") sales.pix += valor;
  if(metodo === "Cart√£o D√©bito") sales.debito += valor;
  if(metodo === "Cart√£o Cr√©dito") sales.credito += valor;

  localStorage.setItem("sales", JSON.stringify(sales));
}

/* ================= INTERCEPTA FINALIZA√á√ÉO DO PEDIDO ================= */
const _finishOrderBase = finishOrder;
finishOrder = function(){

  const payment = document.getElementById("paymentMethod").value;

  let total = 0;
  cart.forEach(i => total += i.price);
  if(isDelivery) total += deliveryFee;

  // salva venda antes de enviar pedido
  saveSale(total, payment);

  _finishOrderBase();
};

/* ================= MOSTRAR RELAT√ìRIO ================= */
function showReport(){
  const s = getSales();

  alert(
`üìä RELAT√ìRIO DE VENDAS

üí∞ Total Geral: R$ ${s.total.toFixed(2).replace('.',',')}

üíµ Dinheiro: R$ ${s.dinheiro.toFixed(2).replace('.',',')}
üì≤ Pix: R$ ${s.pix.toFixed(2).replace('.',',')}
üí≥ D√©bito: R$ ${s.debito.toFixed(2).replace('.',',')}
üí≥ Cr√©dito: R$ ${s.credito.toFixed(2).replace('.',',')}`
  );
}

/* ================= GANCHO NA BUSCA ================= */
const _searchReport = searchProduct;
searchProduct = function(q){
  const term = q.toLowerCase().trim();

  if(term === "relatorio"){
    if(prompt("Senha ADM") === "adm"){
      showReport();
    }else{
      alert("Senha incorreta");
    }
    document.getElementById("searchInput").value = "";
    return;
  }

  _searchReport(q);
};
</script>

<!-- ================= FIM PARTE 10 ================= -->
<!-- ================= PARTE 11 ‚Äì AJUSTES FINAIS ================= -->

<script>
/* ================= ESTABILIDADE GERAL ================= */

/* Garante admin fechado ao iniciar */
document.addEventListener("DOMContentLoaded", () => {
  const admin = document.getElementById("adminOverlay");
  if(admin) admin.style.display = "none";
});

/* Evita zoom acidental em mobile */
document.addEventListener("gesturestart", e => e.preventDefault());

/* Fecha resultados da busca ao perder foco */
const searchInput = document.getElementById("searchInput");
if(searchInput){
  searchInput.addEventListener("blur", ()=>{
    setTimeout(()=>{
      const r = document.getElementById("searchResults");
      if(r) r.style.display = "none";
    },200);
  });
}

/* ================= RESET ADMINISTRATIVO ================= */
/* Palavra na busca: resetadm | Senha: adm */

const _searchReset = searchProduct;
searchProduct = function(q){
  const term = q.toLowerCase().trim();

  if(term === "resetadm"){
    if(prompt("Senha ADM") === "adm"){
      if(confirm("Deseja apagar TODAS as ofertas e relat√≥rios?")){
        localStorage.removeItem("offers");
        localStorage.removeItem("sales");
        alert("Dados apagados com sucesso");
        location.reload();
      }
    }else{
      alert("Senha incorreta");
    }
    document.getElementById("searchInput").value = "";
    return;
  }

  _searchReset(q);
};

/* ================= PROTE√á√ÉO CONTRA ERROS ================= */
window.addEventListener("error", function(e){
  console.warn("Erro capturado:", e.message);
});
</script>

<!-- ================= FECHAMENTO FINAL ================= -->
</div> <!-- FECHA #app -->
</body>
</html>

<!-- ================= FIM PARTE 11 ================= -->
